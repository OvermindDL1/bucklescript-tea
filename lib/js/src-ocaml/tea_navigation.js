// Generated by BUCKLESCRIPT VERSION 4.0.7, PLEASE EDIT WITH CARE
'use strict';

var Block = require("bs-platform/lib/js/block.js");
var Curry = require("bs-platform/lib/js/curry.js");
var Tea_app = require("./tea_app.js");
var Tea_sub = require("./tea_sub.js");
var Web_window = require("./web_window.js");
var Web_location = require("./web_location.js");
var Web_window_history = require("./web_window_history.js");

function getLocation(param) {
  return Web_location.asRecord(document.location);
}

var notifier = /* record */[/* contents */undefined];

function notifyUrlChange(param) {
  var match = notifier[0];
  if (match !== undefined) {
    var $$location = Web_location.asRecord(document.location);
    Curry._1(match, $$location);
    return /* () */0;
  } else {
    return /* () */0;
  }
}

function subscribe(tagger) {
  var enableCall = function (callbacks) {
    var notifyHandler = function ($$location) {
      return Curry._1(callbacks[/* enqueue */0], Curry._1(tagger, $$location));
    };
    notifier[0] = notifyHandler;
    var handler = function (_event) {
      return notifyUrlChange(/* () */0);
    };
    Web_window.addEventListener("popstate", handler, false);
    return (function (param) {
        return Web_window.removeEventListener("popstate", handler, false);
      });
  };
  return Tea_sub.registration("navigation", enableCall);
}

function replaceState(url) {
  Web_window_history.replaceState(window, JSON.parse("{}"), "", url);
  return /* () */0;
}

function pushState(url) {
  Web_window_history.pushState(window, JSON.parse("{}"), "", url);
  return /* () */0;
}

function modifyUrl(url) {
  return /* EnqueueCall */Block.__(2, [(function (_enqueue) {
                replaceState(url);
                notifyUrlChange(/* () */0);
                return /* () */0;
              })]);
}

function newUrl(url) {
  return /* EnqueueCall */Block.__(2, [(function (_enqueue) {
                pushState(url);
                notifyUrlChange(/* () */0);
                return /* () */0;
              })]);
}

function go(step) {
  return /* EnqueueCall */Block.__(2, [(function (_enqueue) {
                Web_window_history.go(window, step);
                notifyUrlChange(/* () */0);
                return /* () */0;
              })]);
}

function back(step) {
  return go(-step | 0);
}

var forward = go;

function navigationProgram(locationToMessage, stuff) {
  var init = function (flag) {
    return Curry._2(stuff[/* init */0], flag, Web_location.asRecord(document.location));
  };
  var subscriptions = function (model) {
    return /* Batch */Block.__(0, [/* :: */[
                subscribe(locationToMessage),
                /* :: */[
                  Curry._1(stuff[/* subscriptions */3], model),
                  /* [] */0
                ]
              ]]);
  };
  var partial_arg_001 = /* update */stuff[/* update */1];
  var partial_arg_002 = /* view */stuff[/* view */2];
  var partial_arg_004 = /* shutdown */stuff[/* shutdown */4];
  var partial_arg = /* record */[
    /* init */init,
    partial_arg_001,
    partial_arg_002,
    /* subscriptions */subscriptions,
    partial_arg_004
  ];
  return (function (param, param$1) {
      return Tea_app.program(partial_arg, param, param$1);
    });
}

exports.getLocation = getLocation;
exports.notifier = notifier;
exports.notifyUrlChange = notifyUrlChange;
exports.subscribe = subscribe;
exports.replaceState = replaceState;
exports.pushState = pushState;
exports.modifyUrl = modifyUrl;
exports.newUrl = newUrl;
exports.go = go;
exports.back = back;
exports.forward = forward;
exports.navigationProgram = navigationProgram;
/* No side effect */
